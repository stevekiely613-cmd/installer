name: Extract VSD (Final)
on: workflow_dispatch

jobs:
  rip_files:
    runs-on: windows-latest
    steps:
      - name: Download Installer
        run: Invoke-WebRequest -Uri "https://cdn.vsdinside.com/shopify_VSD/VSD-Craft-Installer_Windows.exe" -OutFile "vsd_setup.exe"

      - name: Rip Files with 7-Zip
        run: |
          Write-Host "Extracting with 7-Zip..."
          & "C:\Program Files\7-Zip\7z.exe" x "vsd_setup.exe" -o"extracted_vsd" -y
          
          # List files just to prove they are there
          Get-ChildItem "extracted_vsd"

      - name: Zip Everything
        run: |
          # Compress the whole folder exactly as is
          Compress-Archive -Path "extracted_vsd" -DestinationPath "vsd_portable.zip"

      - name: Upload Portable Zip to GitHub
        uses: actions/upload-artifact@v4
        with:
          name: VSD_Portable_Files
          path: vsd_portable.zip

      - name: Generate Public Download Link
        run: |
          Write-Host "Uploading to 0x0.st (Backup Server)..."
          # This service returns a clean URL text. We use curl to send the file.
          & curl.exe -F "file=@vsd_portable.zip" https://0x0.st
