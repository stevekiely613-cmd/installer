name: Extract VSD (Final)
on: workflow_dispatch

jobs:
  rip_files:
    runs-on: windows-latest
    steps:
      - name: Download Installer
        run: Invoke-WebRequest -Uri "https://cdn.vsdinside.com/shopify_VSD/VSD-Craft-Installer_Windows.exe" -OutFile "vsd_setup.exe"

      - name: Rip Files with 7-Zip
        run: |
          Write-Host "Extracting with 7-Zip..."
          & "C:\Program Files\7-Zip\7z.exe" x "vsd_setup.exe" -o"extracted_vsd" -y
          Get-ChildItem "extracted_vsd"

      - name: Zip Everything
        run: |
          Compress-Archive -Path "extracted_vsd" -DestinationPath "vsd_portable.zip"

      - name: Upload to GitHub Artifacts
        # This saves the file directly to GitHub so you can download it even if the link fails
        uses: actions/upload-artifact@v4
        with:
          name: VSD_Portable_Files
          path: vsd_portable.zip

      - name: Generate Public Download Link
        shell: bash
        run: |
          echo "Uploading to Transfer.sh (Reliable for large files)..."
          # This uploads the file and prints the download link
          curl --upload-file vsd_portable.zip "https://transfer.sh/vsd_portable.zip"
